@import views.html.help.help_table
@import views.ViewHelper
@()(implicit request: play.api.mvc.Request[Any])

<div id="query-operations">
    <h2>Query Operations</h2>
    These operations for running a query on the server. The user should save the query then run it on the server.
    For this there are two main services:
    <ul>
        <li>Save query</li>
        <li>Run query</li>
    </ul>

    <h3>Save and Run Query</h3>
    @help_table(controllers.gmql.routes.QueryMan.saveQueryAs("{fileName}", "{fileKey}"),
        Map("fileName" -> "The name of the file to save",
            "fileKey" -> ("It is a number that points to the file in the repository. " +
                    "This number is got when browsing the repository using repository web services. " +
                    "When this is a new file then the fileKey is empty.")),
        Map("text/plain" -> "fileKey on success"))
        <br> <br>
    @help_table(controllers.gmql.routes.QueryMan.runQueryV2File("{fileKey}", "{gtfOutput}", "{execType}"),
        Map("fileKey" -> ("It is a number that points to the file in the repository. " +
                "This number is got when browsing the repository using repository web services."),
            "gtfOutput" -> "If the result is gtf format or not",
            "execType" -> "Plain‐text which can be the value of either “spark” or “flink”. "
        ),
        Map("text/plain" -> "Plain‐text representation the word \"OK\""))


        <button id="query-save" type="button" class="help-button">
            @ViewHelper.reformat(controllers.gmql.routes.QueryMan.saveQueryAs("fileName.gmql", "null"))
        <br>
            then
        <br>
        @ViewHelper.reformat(controllers.gmql.routes.QueryMan.runQueryV2File("{fileKey}", "true", "spark"))
        </button>
        <div id="query-save-input"></div>
        <h4 id="query-save-header"></h4>
        <div class="row">
            <div id="query-save-request" class="col-sm-4"></div>
            <div id="query-save-response" class="col-sm-4"></div>
            <div id="query-save-result" class="col-sm-4"></div>
        </div>

        <h4 id="query-run-header"></h4>
        <div class="row">
            <div id="query-run-request" class="col-sm-4"></div>
            <div id="query-run-response" class="col-sm-4"></div>
            <div id="query-run-result" class="col-sm-4"></div>
        </div>

        <h3>Job status</h3>
    @help_table(controllers.gmql.routes.QueryMan.traceJobV2("{jobId}"),
        Map("jobId" -> "It is a string that represents the jobid and this is returned when running the job using the previous web service."),
        Map("application/xml" -> "Response containing status xml on success"))

        <button id="query-status" type="button" class="help-button">
        @ViewHelper.reformat(controllers.gmql.routes.QueryMan.traceJobV2("{lastJobId}"))
        </button>
        <div class="row">
            <div id="query-status-request" class="col-sm-4"></div>
            <div id="query-status-response" class="col-sm-4"></div>
            <div id="query-status-result" class="col-sm-4"></div>
        </div>


        <h3>Job log</h3>
    @help_table(controllers.gmql.routes.QueryMan.traceJobV2("{jobId}"),
        Map("jobId" -> "It is a string that represents the jobid and this is returned when running the job using the previous web service."),
        Map("application/xml" -> "Response containing log xml on success"))
        <button id="query-log" type="button" class="help-button">
        @ViewHelper.reformat(controllers.gmql.routes.QueryMan.getLog("{lastJobId}"))
        </button>
        <div class="row">
            <div id="query-log-request" class="col-sm-4"></div>
            <div id="query-log-response" class="col-sm-4"></div>
            <div id="query-log-result" class="col-sm-4"></div>
        </div>
    </div>
<script src="@routes.Assets.at("javascripts/help_query.js")" type="text/javascript"></script>
